<div class="animated fadeIn">
  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check2-square" viewBox="0 0 16 16">
            <path d="M3 14.5A1.5 1.5 0 0 1 1.5 13V3A1.5 1.5 0 0 1 3 1.5h8a.5.5 0 0 1 0 1H3a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5V8a.5.5 0 0 1 1 0v5a1.5 1.5 0 0 1-1.5 1.5H3z"/>
            <path d="m8.354 10.354 7-7a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0z"/>
          </svg> 
          Solicitação de Habilitação
        </div>
        <div class="card-block">
          <div class="table-responsive mt-4">
            <table class="table table-striped" [mfData]="habilitacao" #mfHabilitacao="mfDataTable" [mfRowsOnPage]="5">
              <thead>
                <tr>
                  <th>
                    <mfDefaultSorter by="dataCadastro">Data Cadastro</mfDefaultSorter>
                  </th>
                  <th>
                    <mfDefaultSorter by="leilao.nome">Leilão</mfDefaultSorter>
                  </th>
                  <th>
                    <mfDefaultSorter by="pessoa.pessoa.nomeCompleto">Usuário</mfDefaultSorter>
                  </th>
                  <!-- <th>
                    <mfDefaultSorter by="para">Para</mfDefaultSorter>
                  </th> -->
                  <th>
                    <mfDefaultSorter by="regraHabilitacao.tipoValidacaoRegra">Regra</mfDefaultSorter>
                  </th>
                  <th>
                    <mfDefaultSorter by="status.descricao">Status</mfDefaultSorter>
                  </th>
                  <th>
                    <mfDefaultSorter by="statusCodigo">Status Código</mfDefaultSorter>
                  </th>
                  <th>
                    <mfDefaultSorter by="documentos">Documentos</mfDefaultSorter>
                  </th>
                  <th>
                    Ação
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of mfHabilitacao.data; let i = index">
                  <td>{{item.dataCadastro | amDateFormat:'DD/MM/yyyy HH:mm' }}</td>
                  <td>{{item.leilao.nome}}</td>
                  <td>{{item.usuario.pessoa.nomeCompleto}}</td>
                  <!-- <td>{{item.para}}</td> -->
                  <td>{{getTipoRegra(item.regraHabilitacao.tipoValidacaoRegra) }}</td>
                  <td>{{item.status.descricao }}</td>
                  <td>{{item.statusCodigo }}</td>
                  <td class="text-center" nowrap>
                    <span *ngIf="item.documentos.length == 0">Sem Documentos</span>
                    <button *ngIf="item.documentos.length > 0" type="button" class="btn btn-primary"
                      (click)="openModal(documento, i)"><i class="fa fa-edit"></i>&nbsp; Documentos({{item.documentos.length}})</button>
                  </td>
                  <td class="text-center" nowrap>
                    <button type="button" *ngIf="item.leilao.temAnaliseCadastral" class="btn btn-warning"
                      (click)="openModal(aprovar, i)"><i class="fa fa-edit"></i>&nbsp; Análisar Crédito</button>
                      <button type="button" *ngIf="!item.leilao.temAnaliseCadastral && !item.habilitado" class="btn btn-success"
                      (click)="aprovarSolicitacao(item.solicitacaoHabilitacaoId, i)"><i
                        class="fa fa-edit"></i>&nbsp; Habilitar</button>
                      <button type="button" *ngIf="!item.leilao.temAnaliseCadastral && item.habilitado" class="btn btn-danger"
                       (click)="openModal(desabilitar, i, item.solicitacaoHabilitacaoId)"><i
                        class="fa fa-edit"></i>&nbsp; Desabilitar</button>
                    </td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="10">
                    <mfBootstrapPaginator [rowsOnPageSet]="[5,10,25]"></mfBootstrapPaginator>
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
          <ng-template #documento>
            <div class="modal-header">
              <h4 class="modal-title pull-left">Documentos</h4>
              <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modalRef?.hide()">
                <span aria-hidden="true" class="visually-hidden">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              {{documentosUsuario.documentos.length > 0 ? documentosUsuario.documentos : 'Não existem documentos para serem listados'}}

            </div>
          </ng-template>
          <ng-template #aprovar>
            <div class="modal-header">
              <h4 class="modal-title pull-left">Análise de Crédito</h4>
              <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modalRef?.hide()">
                <span aria-hidden="true" class="visually-hidden">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form [formGroup]="formulario" (ngSubmit)="aprovarSolicitacao()">
                <div class="card-block">
                  <div class="row">

                    <div class="form-group col-12">
                      <label>Limite de Crédito</label>
                      <input type="number" class="form-control" formControlName="limiteCredito">

                    </div>
                  </div>
                  <div class="row">
                    <div class="form-group col-12">
                      <label for="exampleFormControlTextarea1">Observação</label>
                      <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" formControlName="observacao"></textarea>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="form-group col-4">
                    <button type="button"  class="btn btn-success form-control"
                        (click)="aprovarLimiteDeCredito()" >Habilitar</button>
                  </div>

                </div>

              </form>


            </div>
          </ng-template>
          <ng-template #desabilitar>
            <div class="modal-body">
              <h3>Deseja realmente desabilitar o usuario?</h3>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary "(click)="reprovarSolicitacao()"(click)="modalRef?.hide()"><i class="fa fa-save"></i>Sim</button>
              <button type="reset" class="btn btn-danger" (click)="modalRef?.hide()"><i class="fa fa-undo"></i>
                Não</button>
            </div>
          </ng-template>

        </div>
      </div>
    </div>
  </div>
</div>
