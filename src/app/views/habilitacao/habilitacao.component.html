<div class="row linha-seletor">
  <form [formGroup]="filtroLeilao" class="col-4">
    <select class="form-control col-12" aria-label="Default select example" (change)="filtrarPorLeilao()" formControlName="leilao" >
      <option value="0" *ngIf="loadingLeilao">CARREGANDO...</option>
      <option value="0">SELECIONE</option>
      <option *ngFor="let item of leiloes" [value]="item.id">{{item.nome}}</option>
    </select>
  </form>

</div>
<div class="animated fadeIn">

  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header">
          <i class="fa fa-check"></i>
          &nbsp;Solicitação de Habilitação
        </div>

        <div class="card-block" >
          <div class="table-responsive mt-4">
            <table class="table table-striped" [mfData]="habilitacao" #mfFiltrado="mfDataTable" [mfRowsOnPage]="5">
              <thead>
                <tr>
                  <th>
                    <mfDefaultSorter by="dataCadastro">Data</mfDefaultSorter>
                  </th>
                  <!-- <th>
                    <mfDefaultSorter by="leilao.nome">Leilão</mfDefaultSorter>
                  </th>
                  <th>
                    <mfDefaultSorter by="tipoLoteId">Tipo Lote</mfDefaultSorter>
                  </th> -->
                  <th>
                    <mfDefaultSorter by="pessoa.pessoa.nomeCompleto">Usuário</mfDefaultSorter>
                  </th>
                  <!-- <th>
                    <mfDefaultSorter by="para">Para</mfDefaultSorter>
                  </th> -->
                  <th>
                    <mfDefaultSorter by="regraHabilitacao.tipoValidacaoRegra">Regra</mfDefaultSorter>
                  </th>
                  <th>
                    <mfDefaultSorter by="status.descricao">Status</mfDefaultSorter>
                  </th>
                  <th>
                    <mfDefaultSorter by="statusCodigo">Status Código</mfDefaultSorter>
                  </th>
                  <th class="text-center">
                    <mfDefaultSorter by="documentos">Documentos</mfDefaultSorter>
                  </th>
                  <th class="text-center">
                    Ação
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of mfFiltrado.data; let i = index">
                  <td class="text-nowrap">{{item.dataCadastro | amDateFormat:'DD/MM/yyyy HH:mm' }}</td>
                  <!-- <td>{{item.leilao.nome}}</td>
                  <td>{{item.tipoLote?.descricao}}</td> -->
                  <td><a [routerLink]="['/update-usuarios', item.usuarioId]">{{item.email}}</a></td>
                  <td>{{item.regra }}</td>
                  <td>{{item.status }}</td>
                  <td>{{item.statusCodigo }}</td>
                  <td class="text-center" nowrap>
                    <span *ngIf="item.documentos.length == 0">Sem Documentos</span>
                    <button *ngIf="item.documentos.length > 0" type="button" class="btn btn-primary btn-sm"
                      (click)="openModal(documento, item.solicitacaoHabilitacaoId)"><i class="fa fa-file"></i>&nbsp; {{item.documentos.length}} Documentos</button>
                  </td>
                  <td class="text-center" nowrap>
                    <button type="button" *ngIf="item.temAnaliseCadastral && !item.habilitado" class="btn btn-warning btn-sm"
                      (click)="openModal(aprovar, i)"><i class="fa fa-money"></i>&nbsp; Análisar Crédito</button>
                      <button type="button" *ngIf="!item.temAnaliseCadastral && !item.habilitado" class="btn btn-success btn-sm"
                      (click)="aprovarSolicitacao(item.solicitacaoHabilitacaoId, i)"><i
                        class="fa fa-check"></i>&nbsp; Habilitar</button>
                      <button type="button" *ngIf="item.habilitado" class="btn btn-danger btn-sm"
                       (click)="openModal(desabilitar, i, item.solicitacaoHabilitacaoId)"><i
                        class="fa fa-ban"></i>&nbsp; Desabilitar</button>
                    </td>
                </tr>
                <tr *ngIf="loading">
                  <td class="text-center text-muted" colspan="9">
                    <h5><i class="fa fa-spin fa-spinner"></i>&nbsp;Carregando...</h5>
                  </td>
                </tr>
                <tr *ngIf="mfFiltrado.data.length === 0 && !loading" >
                  <td class="text-center text-muted" colspan="9">
                    <h6 *ngIf="habilitacao">Não há Habilitações para este Leilão</h6>
                    <h6 *ngIf="!habilitacao">Selecione um leilão</h6>
                  </td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="10">
                    <mfBootstrapPaginator [rowsOnPageSet]="[5,10,25]"></mfBootstrapPaginator>
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
          <ng-template #documento>
            <div class="modal-header">
              <h4 class="modal-title pull-left">Documentos</h4>
              <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modalRef?.hide()">
                <span aria-hidden="true" class="visually-hidden">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <table class="table">
                <tr>
                  <th>Documento</th>
                  <th>Tamanho</th>
                  <th>Download</th>
                  <th>Válido</th>
                </tr>
                <tr *ngFor="let doc of documentosUsuario.documentos">
                  <td>{{doc.nome}}</td>
                  <td>{{formatBytes(doc.tamanho)}}</td>
                  <td><button class="btn btn-success btn-sm" (click)="downloadFile(doc.arquivoId)"><i class="fa fa-download"></i>&nbsp; Download</button></td>
                </tr>
              </table>
              <!-- {{documentosUsuario.documentos.length > 0 ? documentosUsuario.documentos : 'Não existem documentos para serem listados'}} -->

            </div>
          </ng-template>
          <ng-template #aprovar>
            <div class="modal-header">
              <h4 class="modal-title pull-left">Análise de Crédito</h4>
              <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modalRef?.hide()">
                <span aria-hidden="true" class="visually-hidden">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form [formGroup]="formulario" (ngSubmit)="aprovarSolicitacao()">
                <div class="card-block">
                  <div class="row">

                    <div class="form-group col-12">
                      <label>Limite de Crédito</label>
                      <input type="text" class="form-control"
                      id="valorOutrasTaxas" formControlName="limiteCredito" currencyMask
                      [options]="{ prefix: 'R$ ', thousands: '.', decimal: ',' }">
                    </div>
                  </div>
                  <div class="row">
                    <div class="form-group col-12">
                      <label for="exampleFormControlTextarea1">Observação</label>
                      <textarea class="form-control" id="exampleFormControlTextarea1" rows="3" formControlName="observacao"></textarea>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="form-group col-4">
                    <button type="button"  class="btn btn-success form-control"
                        (click)="aprovarLimiteDeCredito()" (click)="modalRef?.hide()" >Habilitar</button>
                  </div>

                </div>

              </form>


            </div>
          </ng-template>
          <ng-template #desabilitar>
            <div class="modal-body">
              <h3>Deseja realmente desabilitar o usuario?</h3>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary "(click)="reprovarSolicitacao()" (click)="modalRef?.hide()">Sim</button>
              <button type="reset" class="btn btn-danger" (click)="modalRef?.hide()">Não</button>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>
