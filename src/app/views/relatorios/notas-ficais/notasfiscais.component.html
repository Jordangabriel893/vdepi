<ngx-loading [show]="loading" [config]="{ backdropBrecolhimentoRadius: '0px' }"></ngx-loading>
<div class="animated fadeIn">
  <div class="dashboard-bar">
    <div class="row justify-content-end">
      <div class="col-md-5 text-right">
        <i class="far fa-calendar"></i>&nbsp;<span #dp="bsDaterangepicker" [(bsValue)]="periodo" bsDaterangepicker [bsConfig]="bsConfig" title="Periodo" class="dash-periodo">{{periodo[0] | amDateFormat:'DD MMM YY' }} - {{periodo[1] | amDateFormat:'DD MMM YY' }}</span>
      </div>
      <div class="col-md-auto text-right">
        <div class="dropdown" dropdown title="Cliente">
          <div class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" dropdownToggle>
            <i class="far fa-user"></i>&nbsp;
            <span class="d-md-down-none">{{clienteSelected?.nome}}</span>
          </div>
          <div class="dropdown-menu dropdown-menu-right scrollable-dropdown" *dropdownMenu aria-labelledby="simple-dropdown">
            <div class="dropdown-header text-center"><strong>CLIENTE</strong></div>
            <div class="dropdown-item" *ngFor="let cli of clientes; let i = index" (click)="setCliente(cli)" style="cursor:pointer">{{cli.nome}}</div>
          </div>
        </div>
      </div>
      <div class="col-md-auto text-right pr-5">
        <div class="dropdown" dropdown title="Deposito">
          <div class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" dropdownToggle>
            <i class="far fa-building"></i>&nbsp;
            <span class="d-md-down-none">{{depositoSelected?.descricao}}</span>
          </div>
          <div class="dropdown-menu dropdown-menu-right scrollable-dropdown " *dropdownMenu aria-labelledby="simple-dropdown">
            <div class="dropdown-header text-center"><strong>DEPÓSITO</strong></div>
            <div class="dropdown-item" *ngFor="let dep of clienteSelected.depositos; let i = index" (click)="setDeposito(dep)" style="cursor:pointer">{{dep.descricao}}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <div class="row" *ngIf="dadosRelatorio?.length > 0">
        <div class="col text-right">
          <button   type="button"
                    (click)="exportAsPDF()"
                    class="btn btn-danger ml-3"
                    title="Exportar para PDF">
              <i class="fas fa-file-pdf"></i>&nbsp;PDF
          </button>
          <button type="button"
                  (click)="exportAsExcel()"
                  class="btn btn-success ml-2"
                  title="Exportar para Excel">
            <i class="fas fa-file-excel"></i>&nbsp;Excel
        </button>
        </div>
      </div>
      <div class="table-responsive mt-4">
        <div class="table-responsive mt-1">
          <table class="table table-striped table-sm table-responsive-sm" [mfData]="dadosRelatorio" #mfRelatorio="mfDataTable" [mfRowsOnPage]="10">
            <thead>
              <tr>
                <th>
                  <mfDefaultSorter by="numero_formulario_grv">Processo</mfDefaultSorter>
                </th>
                <th>
                  <mfDefaultSorter by="numero_nota_fiscal">Nº NFE</mfDefaultSorter>
                </th>
                <th>
                  <mfDefaultSorter by="codigo_verificacao">Cod. Verif.</mfDefaultSorter>
                </th>
                <th>
                  <mfDefaultSorter by="cpf_cnpj">CPF/CNPJ</mfDefaultSorter>
                </th>
                <th>
                  <mfDefaultSorter by="nota_fiscal_nome">Nome</mfDefaultSorter>
                </th>
                <th>
                  <mfDefaultSorter by="data_liberacao_grv">Data Liberação</mfDefaultSorter>
                </th>
                <!-- <th>
                  <mfDefaultSorter by="atividade">Atividade</mfDefaultSorter>
                </th> -->
                <th>
                  <mfDefaultSorter by="total_com_desconto">Total</mfDefaultSorter>
                </th>
                <th>
                  <mfDefaultSorter by="codigo_erro">Cod</mfDefaultSorter>
                </th>
                <th>
                  <mfDefaultSorter by="mensagem_erro">Mensagem</mfDefaultSorter>
                </th>
                <th>
                  <mfDefaultSorter by="url">Download</mfDefaultSorter>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of mfRelatorio.data">
                <td>{{item.numero_formulario_grv }}</td>
                <td>{{item.numero_nota_fiscal}}</td>
                <td>{{item.codigo_verificacao}}</td>
                <td>{{item.cpf_cnpj}}</td>
                <td>{{item.nota_fiscal_nome}}</td>
                <td>{{item.data_liberacao_grv | amDateFormat:'DD/MM/YYYY HH:mm'}}</td>
                <!-- <td>{{item.atividade}}</td> -->
                <td class="text-nowrap">{{item.total_com_desconto | currencyFormat}}</td>
                <td>{{item.codigo_erro}}</td>
                <td>{{item.mensagem_erro}}</td>
                <td class="text-center">
                  <a [href]="item.url" class="btn btn-link" [title]="'Download Nota' + item.numero_nota_fiscal" target="_blank" *ngIf="item.url">
                    <i class="fa fa-file-pdf text-danger"></i>
                  </a>
                  <span title="Nota não emitida" *ngIf="!item.url"><i class="fa fa-times text-danger" ></i></span>
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="11">
                  <mfBootstrapPaginator [rowsOnPageSet]="[5,10,25]"></mfBootstrapPaginator>
                </td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
