<ngx-loading [show]="loading" [config]="{ backdropBrecolhimentoRadius: '0px' }"></ngx-loading>
<div class="animated fadeIn">
  <div class="dashboard-bar">
    <div class="row justify-content-end">
      <div class="col-md-5 text-right">
        <i class="far fa-calendar"></i> <span #dp="bsDaterangepicker" [(bsValue)]="periodo" (bsValueChange)="bsPeriodoChange()" bsDaterangepicker [bsConfig]="bsConfig" title="Periodo" class="dash-periodo">{{periodo[0] | amDateFormat:'DD MMM YY' }} - {{periodo[1] | amDateFormat:'DD MMM YY' }}</span>
      </div>
      <div class="col-md-auto text-right">
        <div class="dropdown" dropdown title="Cliente">
          <div class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" dropdownToggle>
            <i class="far fa-user"></i>
            <span class="d-md-down-none">{{clienteSelected?.nome}}</span>
          </div>
          <div class="dropdown-menu dropdown-menu-right scrollable-dropdown" *dropdownMenu aria-labelledby="simple-dropdown">
            <div class="dropdown-header text-center"><strong>CLIENTE</strong></div>
            <div class="dropdown-item" *ngFor="let cli of clientes; let i = index" (click)="setCliente(cli)" style="cursor:pointer">{{cli.nome}}</div>
          </div>
        </div>
      </div>
      <div class="col-md-auto text-right pr-5">
        <div class="dropdown" dropdown title="Deposito">
          <div class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" dropdownToggle>
            <i class="far fa-building"></i>
            <span class="d-md-down-none">{{depositoSelected?.descricao}}</span>
          </div>
          <div class="dropdown-menu dropdown-menu-right scrollable-dropdown " *dropdownMenu aria-labelledby="simple-dropdown">
            <div class="dropdown-header text-center"><strong>DEPÓSITO</strong></div>
            <div class="dropdown-item" *ngFor="let dep of clienteSelected.depositos; let i = index" (click)="setDeposito(dep)" style="cursor:pointer">{{dep.descricao}}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row" *ngIf="contador">
    <div class="col-md-3">
      <div class="card text-white bg-danger">
        <div class="card-body">
          <div class="float-right block-icon" dropdown>
            <span class="fa-layers fa-fw">
              <i class="fas fa-car" data-fa-transform="grow-2"></i>
              <i class="fa fa-times-circle stroke-danger" data-fa-transform="shrink-8 up-5 right-8"></i>
            </span>
          </div>
          <div class="h5">Recolhidos</div>
          <div class="text-value">{{contador.recolhidos}}</div>
        </div>
      </div>
    </div><!--/.col-->
    <div class="col-md-3">
      <div class="card text-white bg-success">
        <div class="card-body">
          <div class="float-right block-icon" dropdown>
            <span class="fa-layers fa-fw">
              <i class="fas fa-car" data-fa-transform="grow-2"></i>
              <i class="fa fa-check-circle stroke-success" data-fa-transform="shrink-8 up-5 right-8"></i>
            </span>
          </div>
          <div class="h5">Liberados</div>
          <div class="text-value">{{contador.liberados}}</div>
        </div>
      </div>
    </div><!--/.col-->
    <div class="col-md-3">
      <div class="card text-white bg-info">
        <div class="card-body">
          <div class="float-right block-icon" dropdown>
            <span class="fa-layers fa-fw">
              <i class="fas fa-car" data-fa-transform="grow-2"></i>
              <i class="fa fa-map-marker stroke-info" data-fa-transform="shrink-8 up-5 right-8"></i>
            </span>
          </div>
          <div class="h5">Estoque</div>
          <div class="text-value">{{contador.estoque}}</div>
        </div>
      </div>
    </div><!--/.col-->
    <div class="col-md-3">
      <div class="card text-white bg-warning">
        <div class="card-body">
          <div class="float-right block-icon" dropdown>
            <span class="fa-layers fa-fw">
              <i class="fas fa-mobile-alt fa-inverse" data-fa-transform="shrink-5 up-4"></i>
              <i class="fas fa-mobile-alt fa-inverse" data-fa-transform="shrink-6 down-4.2 left-4"></i>
              <i class="fas fa-mobile-alt fa-inverse" data-fa-transform="shrink-6 down-4.2 right-4"></i>
            </span>
          </div>
          <div class="h5">Pré-Leilão</div>
          <div class="text-value">{{contador.estoque_pre_leilao}}</div>
        </div>
      </div>
    </div><!--/.col-->
  </div><!--/.row-->
  <div class="card">
    <div class="card-body">
      <div class="row">
        <div class="col-md-7" *ngIf="apreensaoLiberacao">
          <h4 class="card-title mb-0">Liberações x Recolhimentos</h4>
          <div class="small text-muted">{{periodo[0] | amDateFormat:'DD MMM YY' }} - {{periodo[1] | amDateFormat:'DD MMM YY' }}</div>
          <div class="chart-wrapper" style="height:300px;margin-top:40px;">
            <canvas baseChart class="chart" #apreensaoChart
                    [datasets]="apreensaoLiberacao"
                    [labels]="lineChart1Labels"
                    [options]="lineChart1Options"
                    [colors]="lineChart1Colours"
                    [chartType]="lineChart1Type"
                    (chartClick)="chartLine1Clicked($event)"></canvas>
          </div>
        </div>
        <div class="col-md-5" *ngIf="doughnutChartData">
          <h4 class="card-title mb-0">Autoridades - Top 10</h4>
          <div class="small text-muted">{{chartAutoridadeEnable == 0 ? 'RECOLHIDOS' : 'LIBERADOS'}} : {{criterio}}</div>
          <div class="btn-group float-right">
            <a class="btn btn-sm" [ngClass]="chartAutoridadeEnable == 0 ? 'btn-danger': 'btn-secondary'" href="#" (click)="changeChartAutoridades(0)">
              RECOLHIDOS
            </a>
            <a class="btn btn-sm" [ngClass]="chartAutoridadeEnable == 1 ? 'btn-success': 'btn-secondary'" href="#" (click)="changeChartAutoridades(1)">
              LIBERADOS
            </a>
          </div>
          <div class="chart-wrapper" style="height:300px;margin-top:40px;">
            <div *ngIf="loadingAutoridades" class="text-center pt-5 h4 text-muted">
              <i class="fas fa-circle-notch fa-spin"></i>
              <br />Carregando...
            </div>
            <canvas baseChart class="chart" #autoridadesChart
                    [data]="doughnutChartData"
                    [labels]="doughnutChartLabels"
                    [colors]="doughnutChartColors"
                    [chartType]="doughnutChartType"
                    [options]="doughnutChartOptions" *ngIf="!loadingAutoridades"></canvas>
          </div>
        </div>
      </div>
      </div>
    </div>
  <ngx-flip [flip]="flipDiv">
    <div front>
      <div class="card" >
        <div class="card-body">
          <h4 class="card-title mb-0">Acompanhamento Diário </h4>
          <div class="small text-muted">{{criterio}} <button class="btn btn-light" (click)="girar()">></button></div>
          <div class="row mt-4" >
            <div class="col">
              <div class="chart-wrapper" style="margin-top:40px;">
                <div *ngIf="loadingPorDia" class="text-center pt-5 h4 text-muted">
                  <i class="fas fa-circle-notch fa-spin"></i>
                  <br />Carregando...
                </div>
                <canvas baseChart class="chart" #apreensaoDiaChart
                        [datasets]="barChartData"
                        [labels]="barChartLabels"
                        [legend]="barChartLegend"
                        [chartType]="barChartType"
                        [options]="barChartOptions" *ngIf="!loadingPorDia"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div back>
      <div class="card">
        <div class="card-header">
          <i class="fa fa-mobile-alt"></i>Liberados x Recolhidos Detalhado
        </div>
        <div class="card-block">
          <div class="small text-muted">
            {{criterio}}
            <button class="btn btn-light"
                    (click)="girar()">
              >
            </button>
            <div *ngIf="loadingPorMes" class="text-center pt-5 h4 text-muted">
              <i class="fas fa-circle-notch fa-spin"></i>
              <br />Carregando...
            </div>
            <button *ngIf="liberacao?.length > 0 && !loadingPorMes"
                    type="button"
                    (click)="ExportTOExcel()"
                    class="btn btn-success .ml-1"
                    title="Liberações">
              <i class="fas fa-file-excel"></i>&nbsp;Excel
            </button>
          </div>
          <div class="table-responsive mt-4" *ngIf="!loadingPorMes">
            <tabset>
              <tab>
                <ng-template tabHeading>
                  <div class="font-weight-bold text-muted small">
                    <i class="fa fa-tasks"></i> &nbsp; Liberações
                  </div>
                </ng-template>
                <div class="table-responsive mt-1">
                  <table class="table table-striped" [mfData]="liberacao" #mfLiberacao="mfDataTable" [mfRowsOnPage]="10">
                    <thead>
                      <tr>
                        <th>
                          <mfDefaultSorter by="data_liberacao">Data Liberação</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="processo">Processo</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="placa">Placa</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="tipo_veiculo">Tipo veículo</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="marca_modelo">Marca modelo</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="autoridade">Autoridade</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="valor_diaria">Diaria</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="valor_taxa">Taxas</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="valor_diaria">Total faturado</mfDefaultSorter>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of mfLiberacao.data">
                        <td>{{item.data_liberacao }}</td>
                        <td>{{item.processo}}</td>
                        <td>{{item.placa}}</td>
                        <td>{{item.tipo_veiculo}}</td>
                        <td>{{item.marca_modelo}}</td>
                        <td>{{item.autoridade}}</td>
                        <td>{{item.valor_diaria}}</td>
                        <td>{{item.valor_taxa}}</td>
                        <td>{{item.valor_diaria + item.valor_taxa }}</td>
                      </tr>
                    </tbody>
                    <tfoot>
                      <tr>
                        <td colspan="9">
                          <mfBootstrapPaginator [rowsOnPageSet]="[5,10,25]"></mfBootstrapPaginator>
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </tab>
              <tab>
                <ng-template tabHeading>
                  <div class="font-weight-bold text-muted small">
                    <i class="fa fa-redo-alt"></i>&nbsp; Recolhimeto
                  </div>
                </ng-template>
                <div class="table-responsive mt-1">
                  <table class="table table-striped" [mfData]="recolhimento" #mfRecolhimento="mfDataTable" [mfRowsOnPage]="10">
                    <thead>
                      <tr>
                        <th>
                          <mfDefaultSorter by="data_guarda">Data Guarda</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="processo">Processo</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="placa">Placa</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="tipo_veiculo">Tipo veículo</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="marca_modelo">Marca modelo</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="autoridade">Autoridade</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="cor">Cor</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="numero_chave">Numero Chave</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="estacionamento_setor">Setor</mfDefaultSorter>
                        </th>
                        <th>
                          <mfDefaultSorter by="estacionamento_numero_vaga">Vaga</mfDefaultSorter>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of mfRecolhimento.data">
                        <td>{{item.data_guarda}}</td>
                        <td>{{item.processo}}</td>
                        <td>{{item.placa}}</td>
                        <td>{{item.tipo_veiculo}}</td>
                        <td>{{item.marca_modelo}}</td>
                        <td>{{item.autoridade}}</td>
                        <td>{{item.cor}}</td>
                        <td>{{item.numero_chave}}</td>
                        <td>{{item.estacionamento_setor}}</td>
                        <td>{{item.estacionamento_numero_vaga}}</td>
                      </tr>
                    </tbody>
                    <tfoot>
                      <tr>
                        <td colspan="10">
                          <mfBootstrapPaginator [rowsOnPageSet]="[5,10,25]"></mfBootstrapPaginator>
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </tab>
            </tabset>

          </div>
        </div>
      </div>
    </div>
</ngx-flip>
</div>
